<?php
// ===========================================
// 共通関数ファイル（funcs.php）
// ===========================================
// このファイルには、複数のページで使用する
// 共通の関数をまとめています。
// 各ページで include("funcs.php"); として読み込みます。
// ===========================================


// -----------------------------------------
// XSS対策用のエスケープ関数
// -----------------------------------------
// 使用場所: HTMLに値を出力する全ての箇所
// 目的: <script>などの悪意あるコードを無効化
// -----------------------------------------
function h($str) {
    return htmlspecialchars($str, ENT_QUOTES, 'UTF-8');
}


// -----------------------------------------
// データベース接続関数
// -----------------------------------------
// 戻り値: PDOオブジェクト
// 目的: DB接続処理を1箇所にまとめて保守性向上
// -----------------------------------------
function db_conn() {
    try {
        // -----------------------------------------
        // ローカル環境（XAMPP/MAMP）の設定
        // -----------------------------------------
        $db_name = "gs_db";      // データベース名
        $db_id   = "root";       // ユーザー名
        $db_pw   = "";           // パスワード（XAMPPは空、MAMPは"root"）
        $db_host = "localhost";  // ホスト名

        // -----------------------------------------
        // 本番環境の設定（さくらサーバーなど）
        // localhost以外の場合に切り替わる
        // -----------------------------------------
        if ($_SERVER["HTTP_HOST"] != 'localhost') {
            $db_name = "";       // 本番環境のDB名
            $db_id   = "";       // 本番環境のユーザー名
            $db_pw   = "";       // 本番環境のパスワード
            $db_host = "";       // 本番環境のホスト名
        }

        // -----------------------------------------
        // PDOでデータベースに接続
        // -----------------------------------------
        return new PDO(
            'mysql:dbname=' . $db_name . ';charset=utf8;host=' . $db_host,
            $db_id,
            $db_pw
        );

    } catch (PDOException $e) {
        // 接続エラーの場合はメッセージを表示して終了
        exit('DB Connection Error: ' . $e->getMessage());
    }
}


// -----------------------------------------
// SQLエラー表示関数
// -----------------------------------------
// 引数: $stmt - PDOStatementオブジェクト
// 目的: SQLエラー処理を統一化
// -----------------------------------------
function sql_error($stmt) {
    $error = $stmt->errorInfo();
    exit("SQL Error: " . $error[2]);
}


// -----------------------------------------
// リダイレクト関数
// -----------------------------------------
// 引数: $file_name - リダイレクト先のファイル名
// 目的: ページ遷移処理を統一化
// -----------------------------------------
function redirect($file_name) {
    header("Location: " . $file_name);
    exit();
}

