<?php
// ===========================================
// データ登録処理（insert.php）
// ===========================================
// このファイルは index.php のフォームから
// POSTで送信されたデータをDBに登録します。
// ===========================================


// -----------------------------------------
// 1. POSTデータを取得
// -----------------------------------------
// フォームの name 属性の値をキーにして取得
// 例: <input name="name"> → $_POST["name"]
// -----------------------------------------
$name   = $_POST["name"];
$email  = $_POST["email"];
$naiyou = $_POST["naiyou"];


// -----------------------------------------
// 2. 共通関数ファイルを読み込み、DB接続
// -----------------------------------------
// ★ include() で funcs.php を読み込む
// ★ db_conn() でPDOオブジェクトを取得
// -----------------------------------------



// -----------------------------------------
// 3. INSERT文を作成・実行
// -----------------------------------------
// prepare() でSQL文をセット（プレースホルダー使用）
// bindValue() で安全に値をバインド（SQLインジェクション対策）
// execute() でSQLを実行
// -----------------------------------------
$sql = "INSERT INTO gs_an_table (name, email, naiyou, indate) 
        VALUES (:name, :email, :naiyou, sysdate())";

$stmt = $pdo->prepare($sql);

// プレースホルダーに値をバインド
// PDO::PARAM_STR = 文字列型
// PDO::PARAM_INT = 整数型
$stmt->bindValue(':name',   $name,   PDO::PARAM_STR);
// ★ email, naiyou も同様にバインドしてみよう！

// ★ SQLを実行（成功: true, 失敗: false）


// -----------------------------------------
// 4. 実行結果の判定とリダイレクト
// -----------------------------------------
// 成功時: index.php にリダイレクト
// 失敗時: エラーメッセージを表示
// -----------------------------------------
if ($status == false) {
    // SQLエラーの場合
    sql_error($stmt);
} else {
    // 成功時は登録画面に戻る
    redirect("index.php");
}

