<?php

// ===========================================
// エラー表示
// ===========================================
ini_set('display_errors', 'On');    // エラーを表示させる
error_reporting(E_ALL);              // 全てのレベルのエラーを表示

// ===========================================
// アンケートデータの確認・保存
// ===========================================

// -----------------------------------------
// XSS対策用のエスケープ関数
// -----------------------------------------
function h($value) {
    return htmlspecialchars($value, ENT_QUOTES, 'UTF-8');
}

// -----------------------------------------
// 1. POSTデータを取得
// -----------------------------------------
$name = $_POST["name"];
$email = $_POST["email"];
$comment = $_POST["comment"];



// -----------------------------------------
// 2. 現在の日時を取得
// -----------------------------------------
$timestamp = date("Y-m-d H:i:s");

// -----------------------------------------
// 3. CSVフォーマットでデータを作成
//    カンマ区切りで1行のデータにする
// -----------------------------------------
$csvData = $timestamp . "," . $name . "," . $email . "," . $comment . "\n";

// -----------------------------------------
// 4. ファイルに書き込み
//    "a" は追記モード（append）
// -----------------------------------------
// $file = fopen("data/data.csv", "a");
// fwrite($file, $csvData);
// fclose($file);
?>
<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>送信完了</title>
</head>
<body>
    <h1>送信完了</h1>
    
    <p>以下の内容で登録しました。</p>
    
    <ul>
        <!-- h()関数でXSS対策 -->
        <li>登録日時: <?= h($timestamp) ?></li>
        <li>お名前: <?= h($name) ?></li>
        <li>メール: <?= h($email) ?></li>
        <li>ご意見: <?= h($comment) ?></li>
    </ul>
    
    <hr>
    <p>
        <a href="input.php">続けて回答する</a> |
        <a href="list.php">回答一覧を見る</a>
    </p>
</body>
</html>

