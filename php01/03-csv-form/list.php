<?php
// ===========================================
// アンケートデータの一覧表示
// ===========================================

// -----------------------------------------
// XSS対策用のエスケープ関数
// -----------------------------------------
function h($value) {
    return htmlspecialchars($value, ENT_QUOTES, 'UTF-8');
}
?>
<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>回答一覧</title>
</head>
<body>
    <h1>回答一覧</h1>
    
    <?php
    // -----------------------------------------
    // 1. ファイルが存在するかチェック
    // -----------------------------------------
    if (file_exists("data/data.csv")) {
        
        // -----------------------------------------
        // 2. ファイルを開く（"r"は読み取りモード）
        // -----------------------------------------
        // $file = fopen("data/data.csv", "r");
        
        // -----------------------------------------
        // 3. テーブルのヘッダーを出力
        // -----------------------------------------
        echo "<table border='1'>";
        echo "<tr>";
        echo "<th>登録日時</th>";
        echo "<th>お名前</th>";
        echo "<th>メール</th>";
        echo "<th>ご意見</th>";
        echo "</tr>";
        
        // -----------------------------------------
        // 4. ファイルを1行ずつ読み込み
        //    fgets() は1行ずつ読み込む関数
        // -----------------------------------------
        while ($line = fgets($file)) {
            
            // カンマで分割して配列にする
            $data = explode(",", $line);
            
            // テーブルの行を出力
            echo "<tr>";
            echo "<td>" . h($data[0]) . "</td>";  // 登録日時
            echo "<td>" . h($data[1]) . "</td>";  // お名前
            echo "<td>" . h($data[2]) . "</td>";  // メール
            echo "<td>" . h($data[3]) . "</td>";  // ご意見
            echo "</tr>";
        }
        
        echo "</table>";
        
        // -----------------------------------------
        // 5. ファイルを閉じる
        // -----------------------------------------
        fclose($file);
        
    } else {
        // ファイルが存在しない場合
        echo "<p>まだ回答がありません。</p>";
    }
    ?>
    
    <hr>
    <p>
        <a href="input.php">アンケートに回答する</a> |
        <a href="index.html">トップへ戻る</a>
    </p>
</body>
</html>

