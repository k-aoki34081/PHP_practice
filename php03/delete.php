<?php
// ===========================================
// データ削除処理（delete.php）
// ===========================================
// セッションチェックを追加
// 管理者のみ実行可能（権限チェック）
// ===========================================


// -----------------------------------------
// 1. セッション開始（最初に記述必須！）
// -----------------------------------------
session_start();


// -----------------------------------------
// 2. 共通関数ファイルを読み込み
// -----------------------------------------
include("funcs.php");


// -----------------------------------------
// 3. ログイン状態をチェック
// -----------------------------------------
sschk();


// -----------------------------------------
// 4. 管理者権限チェック
// -----------------------------------------
// 削除機能は管理者のみが使用可能
// 一般ユーザーがアクセスした場合はエラー
// -----------------------------------------
require_admin();


// -----------------------------------------
// 5. GETパラメータからIDを取得
// -----------------------------------------
// URLの ?id=1 の部分を取得
// 例: delete.php?id=5 → $id = 5
// -----------------------------------------
$id = $_GET["id"];


// -----------------------------------------
// 6. DB接続
// -----------------------------------------
$pdo = db_conn();


// -----------------------------------------
// 7. DELETE文を作成・実行
// -----------------------------------------
// WHERE id = :id で削除対象を限定（超重要！）
// ※ WHERE を忘れると全データが削除される！
// ※ 削除したデータは復元できない！
// -----------------------------------------
$sql = "DELETE FROM gs_an_table WHERE id = :id";

$stmt = $pdo->prepare($sql);
$stmt->bindValue(':id', $id, PDO::PARAM_INT);

// SQLを実行
$status = $stmt->execute();


// -----------------------------------------
// 8. 実行結果の判定とリダイレクト
// -----------------------------------------
// 成功時: select.php にリダイレクト
// 失敗時: エラーメッセージを表示
// -----------------------------------------
if ($status == false) {
    // SQLエラーの場合
    sql_error($stmt);
} else {
    // 成功時は一覧画面に戻る
    redirect("select.php");
}

